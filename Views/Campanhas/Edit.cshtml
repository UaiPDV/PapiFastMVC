@model BixWeb.Models.Campanha

@{
    ViewData["Title"] = "Editar Campanha";
}

@section Styles {
    <link rel="stylesheet" href="~/css/Pages/Campanhas/editarCampanha.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
}

<!-- Cabeçalho da Página -->
<div class="form-page-header">
    <a asp-action="Index" class="form-back-link">
        <i class="bi bi-arrow-left-circle fs-2"></i>
    </a>
    <h1 class="form-page-title">Editar Campanha</h1>
</div>

<!-- Formulário Principal -->
<div class="form-main-card">
    <form asp-action="Edit" novalidate>
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="codCampanha" />
        <input type="hidden" asp-for="codUsuario" />
        <input type="hidden" asp-for="linkCardapio" />
        <input type="hidden" asp-for="matriculaFuncionario" />
        <input type="hidden" asp-for="typeServise" />
        <input type="hidden" asp-for="codFilial" />

        <!-- Seção 1: Dados da Campanha -->
        <h2 class="form-section-title">1. Dados da Campanha</h2>
        <div class="row g-3 mb-4">
            <div class="col-md-6">
                <label asp-for="nomeCampanha" class="form-label">Nome</label>
                <input asp-for="nomeCampanha" class="form-control" />
                <span asp-validation-for="nomeCampanha" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label asp-for="codFilial" class="form-label">Filial</label>
                <select asp-for="codFilial" class="form-select" asp-items="ViewBag.codFilial" disabled></select>
                <span asp-validation-for="codFilial" class="text-danger"></span>
            </div>
            <div class="col-12 form-switch-container">
                <label for="campanhaAtiva" class="form-switch-wrapper">
                    <div class="form-switch-info">
                        <span class="form-switch-title">Campanha Ativa</span>
                        <p class="form-switch-description">Última atualização em: @Model.dataPostCampanha.ToString("dd/MM/yyyy 'às' HH:mm")</p>
                    </div>
                    <div class="form-toggle-switch">
                        <input class="form-check-input" type="checkbox" role="switch" asp-for="campanhaAtiva" id="campanhaAtiva">
                        <span class="form-toggle-slider"></span>
                    </div>
                </label>
            </div>
        </div>

        <!-- Seção 2: Seleção de Cardápio -->
        <div class="pt-4 border-top">
             <h2 class="form-section-title">2. Selecione o Modelo de Cardápio</h2>
                 
                 <!-- Opção "Nenhum Cardápio" -->
                 <div class="card cardapio-card mb-3 @(Model.tipoCardapio == 0 ? "selected" : "")" data-value="0">
                     <div class="card-body d-flex align-items-center">
                         <input class="form-check-input me-3" type="radio" name="tipoCardapio" id="tipoCardapio0" value="0" @(Model.tipoCardapio == 0 ? "checked" : "")>
                         <label class="form-check-label w-100" for="tipoCardapio0">
                             <span class="fw-bold">Nenhum Cardápio</span>
                             <p class="mb-0 text-muted small">A campanha não exibirá um cardápio digital.</p>
                         </label>
                     </div>
                 </div>

                <!-- Carrossel de Cardápios -->
                <div class="carousel-container">
                    @{
                        var cardapios = new[]
                        {
                            new { id = 1, title = "Modelo 1", text = "Tema simplificado, itens na horizontal e barra de busca.", img = "/imagens/layout.jpg", link = "/ExemploCardapio/Cardapio/Index.html" },
                            new { id = 2, title = "Modelo 2", text = "Tema simplificado, itens em grade e barra de busca.", img = "/imagens/layout2.jpg", link = "/ExemploCardapio/Cardapio2/Index.html" },
                            new { id = 3, title = "Modelo 3", text = "Tema elaborado, categorias, identificação de mesa e pedidos via WhatsApp.", img = "/imagens/layout3.jpg", link = "/ExemploCardapio/Cardapio3/Index.html" },
                            new { id = 4, title = "Modelo 4", text = "Tema avançado com adicionais de itens e integração com robô de atendimento.", img = "/imagens/layout4.jpg", link = "/ExemploCardapio/Cardapio4/Index.html" },
                            new { id = 5, title = "Modelo 5", text = "Tema harmônico (branco/cinza), pedidos via WhatsApp e identificação de mesa.", img = "/imagens/layout5.jpg", link = "/ExemploCardapio/Cardapio5/Index.html" },
                            new { id = 6, title = "Modelo 6", text = "Tema harmônico (branco/verde), itens em blocos e barra de pesquisa.", img = "/imagens/layout6.jpg", link = "/ExemploCardapio/Cardapio6/index.html" }
                        };
                    }

                    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                        @foreach (var cardapio in cardapios)
                        {
                            <div class="col">
                                <div class="card h-100 cardapio-card @(Model.tipoCardapio == cardapio.id ? "selected" : "")" data-value="@cardapio.id">
                                    <img src="@cardapio.img" class="card-img-top" alt="Visualização do Cardápio @cardapio.id" onerror="this.onerror=null;this.src='https://placehold.co/500x200/f8bc1f/FFFFFF?text=Cardápio+@cardapio.id';">
                                    <div class="card-body">
                                        <h5 class="card-title">@cardapio.title</h5>
                                        <p class="card-text small">@cardapio.text</p>
                                    </div>
                                    <div class="card-footer bg-white border-0 pb-3">
                                        <div class="btn-group w-100" role="group">
                                            <label for="tipoCardapio@(cardapio.id)" class="btn btn-outline-primary w-50 select-btn">
                                                <i class="bi bi-check-circle-fill me-2"></i>
                                                Selecionar
                                            </label>
                                            <a href="@cardapio.link" target="_blank" class="btn btn-outline-secondary w-50">
                                                <i class="bi bi-eye me-2"></i>Visualizar
                                            </a>
                                        </div>
                                        <input class="form-check-input visually-hidden" type="radio" name="tipoCardapio" id="tipoCardapio@(cardapio.id)" value="@cardapio.id" @(Model.tipoCardapio == cardapio.id ? "checked" : "")>
                                    </div>
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>

        <!-- Botões de Ação -->
        <div class="form-action-buttons">
            <a asp-action="Index" class="btn btn-light">Cancelar</a>
            <button type="submit" value="Save" class="btn btn-primary d-flex align-items-center" >
                <i class="bi bi-check-circle me-2"></i>
                Salvar Alterações
            </button>
        </div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const cardapioCards = document.querySelectorAll('.cardapio-card');
            const nenhumCardapioRadio = document.getElementById('tipoCardapio0');
            const nenhumCardapioCard = document.querySelector('.cardapio-card[data-value="0"]');

            cardapioCards.forEach(card => {
                card.addEventListener('click', function(e) {
                    // Impede que o clique no link de visualizar dispare a seleção
                    if (e.target.closest('a')) {
                        return;
                    }

                    const radio = card.querySelector('input[type="radio"]');
                    const isSelected = this.classList.contains('selected');

                    // Desseleciona tudo primeiro
                    cardapioCards.forEach(c => c.classList.remove('selected'));

                    // Lógica para desselecionar
                    if (isSelected && radio.value !== "0") {
                        nenhumCardapioRadio.checked = true;
                        nenhumCardapioCard.classList.add('selected');
                    } else { // Lógica para selecionar
                        radio.checked = true;
                        this.classList.add('selected');
                    }
                });
            });
        });
    </script>
}
